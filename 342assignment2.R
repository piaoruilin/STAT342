P128 <- read.table(header=TRUE, text="
Y X1 X2 X3 X4 X5 X6
443 49 79 76 8 15 205
290 27 70 31 6 6 129
676 115 92 130 0 9 339
536 92 62 92 5 8 247
481 67 42 94 16 3 202
296 31 54 34 14 11 119
453 105 60 47 5 10 212
617 114 85 84 17 20 285
514 98 72 71 12 -1 242
400 15 59 99 15 11 174
473 62 62 81 9 1 207
157 25 11 7 9 9 45
440 45 65 84 19 13 195
480 92 75 63 9 20 232
316 27 26 82 4 17 134
530 111 52 93 11 13 256
610 78 102 84 5 7 266
617 106 87 82 18 7 276
600 97 98 71 12 8 266
480 67 65 62 13 12 196
279 38 26 44 10 8 110
446 56 32 99 16 8 188
450 54 100 50 11 15 205
335 53 55 60 8 0 170
459 61 53 79 6 5 193
630 60 108 104 17 8 273
483 83 78 71 11 8 233
617 74 125 66 16 4 265
605 89 121 71 8 8 283
388 64 30 81 10 10 176
351 34 44 65 7 9 143
366 71 34 56 8 9 162
493 88 30 87 13 0 207
648 112 105 123 5 12 340
449 57 69 72 5 4 200
340 61 35 55 13 0 152
292 29 45 47 13 13 123
688 82 105 81 20 9 268
408 80 55 61 11 1 197
461 82 88 54 14 7 225
")

P088 <- read.table(header=TRUE, text="State Age HS Income Black Female Price Sales
AL 27.0 41.3 2948.0 26.2 51.7 42.7 89.8
AK 22.9 66.7 4644.0 3.0 45.7 41.8 121.3
AZ 26.3 58.1 3665.0 3.0 50.8 38.5 115.2
AR 29.1 39.9 2878.0 18.3 51.5 38.8 100.3
CA 28.1 62.6 4493.0 7.0 50.8 39.7 123.0
CO 26.2 63.9 3855.0 3.0 50.7 31.1 124.8
CT 29.1 56.0 4917.0 6.0 51.5 45.5 120.0
DE 26.8 54.6 4524.0 14.3 51.3 41.3 155.0
DC 28.4 55.2 5079.0 71.1 53.5 32.6 200.4
FL 32.3 52.6 3738.0 15.3 51.8 43.8 123.6
GA 25.9 40.6 3354.0 25.9 51.4 35.8 109.9
HI 25.0 61.9 4623.0 1.0 48.0 36.7 82.1
ID 26.4 59.5 3290.0 0.3 50.1 33.6 102.4
IL 28.6 52.6 4507.0 12.8 51.5 41.4 124.8
IN 27.2 52.9 3772.0 6.9 51.3 32.2 134.6
IA 28.8 59.0 3751.0 1.2 51.4 38.5 108.5
KS 28.7 59.9 3853.0 4.8 51.0 38.9 114.0
KY 27.5 38.5 3112.0 7.2 50.9 30.1 155.8
LA 24.8 42.2 3090.0 29.8 51.4 39.3 115.9
ME 28.0 54.7 3302.0 0.3 51.3 38.8 128.5
MD 27.1 52.3 4309.0 17.8 51.1 34.2 123.5
MA 29.0 58.5 4340.0 3.1 52.2 41.0 124.3
MI 26.3 52.8 4180.0 11.2 51.0 39.2 128.6
MN 26.8 57.6 3859.0 0.9 51.0 40.1 104.3
MS 25.1 41.0 2626.0 36.8 51.6 37.5 93.4
MO 29.4 48.8 3781.0 10.3 51.8 36.8 121.3
MT 27.1 59.2 3500.0 0.3 50.0 34.7 111.2
NB 28.6 59.3 3789.0 2.7 51.2 34.7 108.1
NV 27.8 65.2 4563.0 5.7 49.3 44.0 189.5
NH 28.0 57.6 3737.0 0.3 51.1 34.1 265.7
NJ 30.1 52.5 4701.0 10.8 51.6 41.7 120.7
NM 23.9 55.2 3077.0 1.9 50.7 41.7 90.0
NY 30.3 52.7 4712.0 11.9 52.2 41.7 119.0
NC 26.5 38.5 3252.0 22.2 51.0 29.4 172.4
ND 26.4 50.3 3086.0 0.4 49.5 38.9 93.8
OH 27.7 53.2 4020.0 9.1 51.5 38.1 121.6
OK 29.4 51.6 3387.0 6.7 51.3 39.8 108.4
OR 29.0 60.0 3719.0 1.3 51.0 29.0 157.0
PA 30.7 50.2 3971.0 8.0 52.0 44.7 107.3
RI 29.2 46.4 3959.0 2.7 50.9 40.2 123.9
SC 24.8 37.8 2990.0 30.5 50.9 34.3 103.6
SD 27.4 53.3 3123.0 0.3 50.3 38.5 92.7
TN 28.1 41.8 3119.0 15.8 51.6 41.6 99.8
TX 26.4 47.4 3606.0 12.5 51.0 42.0 106.4
UT 23.1 67.3 3227.0 0.6 50.6 36.6 65.5
VT 26.8 57.1 3468.0 0.2 51.1 39.5 122.6
VA 26.8 47.8 3712.0 18.5 50.6 30.2 124.3
WA 27.5 63.5 4053.0 2.1 50.3 40.3 96.7
WV 30.0 41.6 3061.0 3.9 51.6 41.6 114.5
WI 27.2 54.5 3812.0 2.9 50.9 40.2 106.4
WY 27.2 62.9 3815.0 0.8 50.0 34.4 132.2")
P088.fit = lm(Sales ~ Age+HS+Income+Black+Female+Price,data=P088)

summary(P088.fit)



rm.fit.b = lm(Sales ~ Age+Income+Black+Price,data=P088)

summary(rm.fit.b)
# 전체 모델
full.model <- lm(Sales ~ Age + HS + Income + Black + Female + Price, data=data)

# Female 변수 제외 모델
reduced.model.a <- lm(Sales ~ Age + HS + Income + Black + Price, data=data)

# ANOVA를 사용하여 모델 비교
anova(reduced.model.a, full.model)

# Female과 HS 변수를 제외한 모델
reduced.model.b <- lm(Sales ~ Age + Income + Black + Price, data=data)

# ANOVA를 사용하여 모델 비교
anova(reduced.model.b, full.model)
# Income 변수의 회귀 계수에 대한 신뢰 구간
confint(full.model, "Income", level=0.95)


# Income 변수 제외 모델
reduced.model.b <- lm(Sales ~ Age + HS + Black + Female + Price, data=data)
reduced.model.c <- lm(Sales ~ Age  + Income + Price, data=data)

# 전체 모델과 축소 모델의 요약 출력
summary(full.model)$r.squared  # 전체 모델의 R²
summary(reduced.model.b)$r.squared  # Income 변수 제외 모델의 R²
summary(full.model)$r.squared-summary(reduced.model.b)$r.squared

reduced.model.c <- lm(Sales ~ Age  + Income + Price, data=data)
summary(full.model)$r.squared  # 전체 모델의 R²
summary(reduced.model.c)$r.squared  # Price, Age, Income 모델의 R²
summary(full.model)$r.squared-summary(reduced.model.c)$r.squared

reduced.model.d <- lm(Sales ~ Income , data=data)
summary(full.model)$r.squared  # 전체 모델의 R²
summary(reduced.model.d)$r.squared  #Income 모델의 R²
summary(full.model)$r.squared-summary(reduced.model.d)$r.squared


# 주어진 데이터
Y <- c(5, 6, 7, 8, 9)
X1 <- c(1, 2, 3, 4, 5)

# 회귀 모델 적합
model <- lm(Y ~ X1)

# F-테스트 수행
anova_result <- anova(model)

# F-통계량과 p-value 출력
f_statistic <- anova_result$F[1]
p_value <- anova_result$`Pr(>F)`[1]

# 결과 출력
cat("F-Statistic:", f_statistic, "\n")
cat("p-value:", p_value, "\n")

# 유의수준 0.05로 가설 검정
alpha <- 0.05
if (p_value > alpha) {
  cat("귀무 가설을 기각하지 않습니다. (p-value > 0.05)\n")
} else {
  cat("귀무 가설을 기각합니다. (p-value <= 0.05)\n")
}


# 상관 계수 행렬
cor_matrix <- cor(data[2:8])
print(cor_matrix)
install.packages("corrplot")
library(corrplot)
# 산점도 행렬

pairs(data[2:8])

P088.cor = cor(P088[c("Age","HS","Income","Black","Female","Price","Sales" )])

corrplot(P088.cor,method="number",diag=TRUE,type="full")



# Prob 4.8
install.packages("car")

library(car)
P083 <- data.frame(F=c(78,75,85,94,86,90,86,68,55,69,91,75,81,91,80,94,94,97,79,84,65,83),
                   P1=c(73,74,82,90,87,90,83,72,68,69,91,79,89,93,87,91,86,91,81,80,70,79),
                   P2=c(12,76,79,96,90,92,95,69,67,70,89,75,84,97,77,96,94,92,82,83,66,81))

P083.fit2 = lm(F~P2,data=P083)
P083.fit3 = lm(F~P1+P2,data=P083)




# Prob 4.8



e = as.vector(residuals(P083.fit1))

d = e/sqrt(516.34)

p = as.vector(hatvalues(P083.fit1))

po = p/(1-p);

re = ((p+1)/(1-p))*(d**2/(1-d**2));

plot(re,po,pch=19,cex=1, main="Model 1(P1)")

text(re,po,labels=rownames(P083),pos=4,col="red",cex=1,font=1)



e = as.vector(residuals(P083.fit2))

d = e/sqrt(365.46)

p = as.vector(hatvalues(P083.fit2))

po = p/(1-p);

re = ((p+1)/(1-p))*(d**2/(1-d**2));

plot(re,po,pch=19,cex=1, main="Model 2(P2)")

text(re,po,labels=rownames(P083),pos=4,col="red",cex=1,font=1)



e = as.vector(residuals(P083.fit3))

d = e/sqrt(296.83)

p = as.vector(hatvalues(P083.fit3))

po = p/(1-p);

re = ((p+1)/(1-p))*(d**2/(1-d**2));

plot(re,po,pch=19,cex=1, main="Model 1(P1 & P2)")

text(re,po,labels=rownames(P083),pos=4,col="red",cex=1,font=1)



P083.a = P083[which((rownames(P083) != "15") &(rownames(P083) != "7") & (rownames(P083) != "9")),]



P083.fit.a = lm(F~P1+P2,data=P083.a)

summary(P083.fit.a)

#4.12

P128.cor = cor(P128[c("Y","X1","X2","X3","X4","X5","X6")])
corrplot(P128.cor, method="number", diag=TRUE, type="full")

Fitted = as.vector(fitted(P128.fit))
Residual = as.vector(residuals(P128.fit))
Rstandard = as.vector(rstandard(P128.fit))
Rstudent = as.vector(rstudent(P128.fit))
P128.pred = data.frame(P128, Fitted, Residual, Rstandard, Rstudent)
P128.pred

par(mfrow=c(2,3))
plot(P128.fit, which=1:6, col=c("blue", "red", "blue", "blue", "blue", "blue"))


model <- lm(Y ~ X, data=data)
plot(fitted(model), residuals(model),
     xlab="Fitted Values", ylab="Residuals",
     main="Residuals vs Fitted")
abline(h=0, col="red")

# P128.fit 모델에 대한 영향력 지표 계산
influenceMeasures <- influence.measures(P128.fit)
influenceMeasures
# 표준화된 잔차
ri <- rstandard(P128.fit)
ri
# Cook의 거리
Ci <- cooks.distance(P128.fit)
Ci
DFITSi <- dfbetas(P128.fit)
DFITSi
# 레버리지 값 (Hat values)
Hi <- hatvalues(P128.fit)
Hi
par(mfrow=c(3,2)) # 3x2 그래프 배열 설정

# 표준화된 잔차의 인덱스 플롯
plot(ri, type="h", lwd=2, col="blue", main="Standardized Residuals")
abline(h=0, col="red")

# Cook의 거리의 인덱스 플롯
plot(Ci, type="h", lwd=2, col="green", main="Cook's Distance")
abline(h=0.5, col="red", lty=2) # 일반적인 임계값

# DFITS의 인덱스 플롯
plot(DFITSi, type="h", lwd=2, col="purple", main="DFITS")
abline(h=c(-1, 1), col="red", lty=2) # 일반적인 임계값

# 레버리지의 인덱스 플롯
plot(Hi, type="h", lwd=2, col="orange", main="Leverage")
abline(h=2*mean(Hi), col="red", lty=2) # 일반적인 임계값

# 잠재적 잔차 플롯
plot(ri, type="h", lwd=2, col="blue", main="Potential Residuals")
abline(h=c(-2, 2), col="red", lty=2) # 일반적인 임계값

qqnorm(residuals(model))
qqline(residuals(model), col="red")

ri <- rstandard(model)
Ci <- cooks.distance(model)
DFITSi <- dfbetas(model)
DFITSi
Hi <- hatvalues(model)
print(ri,Ci,Hi)

par(mfrow=c(2,2)) # 2x2 그래프 배열 설정

# 표준화된 잔차의 인덱스 플롯
plot(ri, type="h", lwd=2, col="blue", main="Standardized Residuals")
abline(h=0, col="red")

# Cook의 거리의 인덱스 플롯
plot(Ci, type="h", lwd=2, col="green", main="Cook's Distance")
abline(h=0.5, col="red", lty=2) # 일반적인 임계값

# DFITS의 인덱스 플롯
plot(DFITSi, type="h", lwd=2, col="purple", main="DFITS")
abline(h=c(-1, 1), col="red", lty=2) # 일반적인 임계값

# 레버리지의 인덱스 플롯
plot(Hi, type="h", lwd=2, col="orange", main="Leverage")
abline(h=2*mean(Hi), col="red", lty=2) # 일반적인 임계값

# 데이터 준비
data <- matrix(c(
  -0.007255308,  0.0059066692,  0.001958990,  0.002641114,  0.041519208, -0.0655809569, -0.003534241,
  # ... 나머지 데이터 이어 붙이기 ...
  -0.037821164, -0.0529755582, -0.053398562, -0.032391021, -0.178157098,  0.0821531963,  0.046458488
), ncol=7, byrow=TRUE)

# 각 행의 최대 절대값 계산
max_abs_values <- apply(data, 1, function(row) max(abs(row)))

# 기준값 계산
n <- nrow(data) # 관측치의 수
k <- ncol(data) # 변수의 수
cutoff <- 2*sqrt((k+1)/n)

# 이상치 식별
outliers <- which(max_abs_values > cutoff)

# 이상치 출력
print(outliers)

P128dfits <- read.table(header=TRUE, text=" 1  -0.007255308  0.0059066692  0.001958990  0.002641114  0.041519208 -0.0655809569 -0.003534241
2  -0.224029631 -0.0340876225 -0.044086676 -0.033813205  0.133550186  0.0646185569  0.039322673
3   0.013215478  0.0184519431  0.018552500  0.017516124  0.032122667 -0.0008229364 -0.018690087
4   0.028937862  0.0066238998  0.001754288  0.006659030 -0.131184531 -0.0046445274 -0.003856648
5   0.014052823  0.0600851633  0.058993693  0.061614023  0.030173852 -0.0316923224 -0.060180221
6  -0.101319030 -0.0932234415 -0.095688996 -0.091502591 -0.036149566 -0.0337033781  0.095209238
7   0.105520534  0.1214472525  0.114209043  0.110430931 -0.088548550  0.0323479758 -0.115870065
8  -0.035535212 -0.0193895639 -0.020711827 -0.020633179  0.024318642  0.0360105509  0.020426230
9  -0.053432915 -0.0259967424 -0.020411345 -0.018323767 -0.039469105  0.2249440997  0.020828816
10  0.098175151  0.1121559035  0.091941115  0.077348176 -0.150499161 -0.0561710835 -0.093995296
11  0.026423958 -0.0962612902 -0.094178878 -0.092457098 -0.023218108 -0.1177707548  0.094601502
12  0.332766214 -0.1353436592 -0.142364219 -0.150655720 -0.026524682  0.0658235829  0.136008994
13  0.203893065  0.0854988243  0.078966904  0.071258383 -0.339364662 -0.1623065124 -0.078531646
14  0.053778571  0.0684860777  0.072054950  0.074104078  0.009531075 -0.1563179687 -0.071562185
15  0.173436635  0.2288448370  0.230666529  0.239802607 -0.172975441  0.1670632063 -0.234476834
16  0.052356044 -0.1259468054 -0.111774079 -0.119536785 -0.027571654 -0.1204086621  0.118123047
17  0.002556463 -0.3540910378 -0.330308000 -0.343861916 -0.437868909 -0.1436004105  0.347579152
18 -0.015106591 -0.0007970589 -0.001455953 -0.001547373  0.021369566 -0.0026847712  0.001428898
19  0.019816974  0.1480859816  0.147862094  0.141716797  0.007725171 -0.0203408483 -0.144908726
20 -0.111331708 -0.2787542417 -0.282006093 -0.285626286  0.151167261  0.1894009622  0.281118439
21  0.069055410 -0.0791942996 -0.080945463 -0.080531629  0.004212022  0.0079405520  0.078622503
22 -0.019630920 -0.0127501092 -0.013831841 -0.010452020  0.037809262  0.0007212006  0.012372781
23 -0.018803620 -0.0084724902 -0.014975482 -0.007103610  0.015250496 -0.0882929578  0.010534982
24 -0.362857773  0.3381547521  0.329614059  0.334307166  0.177623450  0.5413762543 -0.331830185
25  0.290809945  0.2571101222  0.258804923  0.265034308 -0.239808624 -0.1580503510 -0.260573389
26 -0.068560078 -0.0224004493 -0.016504306 -0.016086335  0.060445428 -0.0192155371  0.019356858
27 -0.009245055 -0.0139601194 -0.012418904 -0.008688135 -0.007368655  0.0134813271  0.011063585
28  0.016256563  0.1050014284  0.113663780  0.104730146  0.055578656 -0.0990517696 -0.106957207
29 -0.005543085 -0.0187341931 -0.017327736 -0.019225086 -0.014282086 -0.0047002450  0.018714345
30 -0.006863960  0.0052065738  0.007496890  0.004558536 -0.002346092 -0.0172703603 -0.005562547
31  0.179155640  0.1296728959  0.133797695  0.135851901 -0.108153041  0.0014975432 -0.134511948
32  0.044032559  0.0081620143  0.004676566  0.005360880 -0.018825134  0.0141360709 -0.006644093
33 -0.066731965 -0.2831829911 -0.306741240 -0.286441844  0.204751549 -0.3075110340  0.292696906
34  0.259248032 -0.4418560814 -0.445876688 -0.462200320  0.573736810 -0.2058395056  0.436845992
35  0.077792413 -0.1025760041 -0.097661167 -0.098905222 -0.119550209 -0.0896653920  0.099802067
36 -0.161357232 -0.0168090029 -0.009932832 -0.011872115 -0.088240074  0.2223120823  0.014765832
37 -0.017459877  0.0996431463  0.097752229  0.098770986 -0.047782441 -0.0781790688 -0.097199325
38 -0.493469847  0.5352671702  0.554176941  0.535371800  0.950848974 -0.0267612458 -0.535395558
39 -0.184816651 -0.0434208217 -0.034034882 -0.031983179 -0.025959940  0.2899773316  0.037333184
40 -0.037821164 -0.0529755582 -0.053398562 -0.032391021 -0.178157098  0.0821531963  0.046458488")
P128dfits[,2:7]
P128dfits<-P128dfits[,2:7]
# P128dfits라는 데이터프레임이 있다고 가정합니다.

# 첫 번째 열을 삭제하는 방법
P128dfits
# 각 행의 최대 절대값 계산
max_abs_values <- apply(P128dfits, 1, function(row) max(abs(row)))

# 기준값 계산
n <- nrow(data) # 관측치의 수
k <- ncol(data) # 변수의 수
cutoff <- 2*sqrt((k+1)/n)

# 이상치 식별
outliers <- which(max_abs_values > cutoff)

# 이상치 출력
print(outliers)